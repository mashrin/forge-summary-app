"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const markdown_it_1 = tslib_1.__importDefault(require("markdown-it"));
const prosemirror_markdown_1 = require("prosemirror-markdown");
const adf_schema_1 = require("@atlaskit/adf-schema");
const editor_json_transformer_1 = require("@atlaskit/editor-json-transformer");
const md = markdown_it_1.default('zero', { linkify: true, breaks: true }).enable([
    'emphasis',
    'strikethrough',
    'newline',
    'link',
    'linkify',
    'backticks',
]);
const auxMarkdownParser = new prosemirror_markdown_1.MarkdownParser(adf_schema_1.defaultSchema, md, {
    paragraph: { block: 'paragraph' },
    softbreak: { node: 'hardBreak' },
    hardbreak: { node: 'hardBreak' },
    strong: { mark: 'strong' },
    em: { mark: 'em' },
    s: { mark: 'strike' },
    // eslint-disable-next-line @typescript-eslint/camelcase
    code_inline: { mark: 'code' },
    link: {
        mark: 'link',
        getAttrs: (tok) => ({
            href: tok.attrGet('href'),
            title: tok.attrGet('title') || null,
        }),
    },
});
const jsonTransformer = new editor_json_transformer_1.JSONTransformer();
exports.md2Adf = (md) => {
    const doc = auxMarkdownParser.parse(md);
    return jsonTransformer.encode(doc);
};
